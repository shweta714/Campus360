<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Profile - Campus360</title>
  <link rel="stylesheet" href="student-dashboard.css">
</head>
<body>
  <nav class="navbar-top">
    <div class="navbar-container">
      <div class="navbar-logo">
        <img src="logo.png" alt="Campus360 Logo" style="height:28px;vertical-align:middle;">
        <span class="navbar-title">PROFILE</span>
      </div>
      <ul class="navbar-menu">
        <li onclick="window.location.href='student-dashboard.html'">&larr; Dashboard</li>
        <li onclick="window.location.href='settings.html'">Settings</li>
      </ul>
    </div>
  </nav>

  <main class="profile-page">
    <div class="profile-card">
      <div class="profile-left">
        <div id="avatarArea" class="profile-avatar" title="Click to change avatar">
          <img id="avatarImg" src="" alt="avatar">
        </div>
        <input id="avatarInput" class="hidden-input" type="file" accept="image/*">

        <div class="avatar-controls">
          <button id="changeAvatar" class="btn">Change</button>
          <button id="removeAvatar" class="btn">Remove</button>
        </div>

        <div class="profile-actions">
          <button id="editBtn" class="btn primary">Edit Profile</button>
          <button id="saveBtn" class="btn" style="display:none;">Save</button>
          <button id="cancelBtn" class="btn" style="display:none;">Cancel</button>
        </div>
      </div>

      <div class="profile-right">
        <h2 id="displayName">Your Name</h2>
        <p class="muted" id="displayRoll">Roll: -</p>

        <form id="profileForm" style="display:none; margin-top:12px;">
          <div class="form-row">
            <label>Full name
              <input type="text" id="inputName">
            </label>
            <label>Roll
              <input type="text" id="inputRoll">
            </label>
          </div>
          <div class="form-row">
            <label>Department
              <input type="text" id="inputDept">
            </label>
            <label>Semester
              <input type="text" id="inputSem">
            </label>
          </div>
          <div class="form-row">
            <label>Email
              <input type="email" id="inputEmail">
            </label>
            <label>Phone
              <input type="text" id="inputPhone">
            </label>
          </div>
          <label>About
            <textarea id="inputAbout" rows="3"></textarea>
          </label>
          <label>Skills (type and press Enter)
            <input id="skillInput" type="text" placeholder="e.g. JavaScript">
          </label>
          <div class="skills-container" id="skillsContainer"></div>
        </form>

        <div id="viewDetails" style="margin-top:12px;">
          <div class="view-grid">
            <div>
              <h3 id="vDept">Department</h3>
              <p class="muted" id="vSem">Semester</p>
            </div>
            <div>
              <h3 id="vEmail">Email</h3>
              <p class="muted" id="vPhone">Phone</p>
            </div>
          </div>

          <h4 style="margin-top:12px;">About</h4>
          <p id="vAbout" class="muted">No info yet.</p>

          <h4 style="margin-top:8px;">Skills</h4>
          <div class="skills-container" id="vSkills"></div>
        </div>

      </div>
    </div>
  </main>

  <script>
    const PROFILE_KEY = 'campus360_profile';
    function readProfile(){
      try{ return JSON.parse(localStorage.getItem(PROFILE_KEY) || '{}'); }catch(e){return {};}
    }
    function saveProfileObj(obj){ localStorage.setItem(PROFILE_KEY, JSON.stringify(obj)); }

    function renderView(profile){
      document.getElementById('displayName').textContent = profile.name || 'Your Name';
      document.getElementById('displayRoll').textContent = profile.roll ? ('Roll: '+profile.roll) : 'Roll: -';
      document.getElementById('vDept').textContent = profile.dept || 'Department';
      document.getElementById('vSem').textContent = profile.sem || 'Semester';
      document.getElementById('vEmail').textContent = profile.email || 'Email';
      document.getElementById('vPhone').textContent = profile.phone || 'Phone';
      document.getElementById('vAbout').textContent = profile.about || 'No info yet.';
      // avatar
      const img = document.getElementById('avatarImg');
      if(profile.avatar){ img.src = profile.avatar; } else { img.src = 'https://via.placeholder.com/160x160.png?text=Avatar'; }
      // skills
      const vSkills = document.getElementById('vSkills'); vSkills.innerHTML='';
      (profile.skills || []).forEach(s=>{ const chip=document.createElement('div'); chip.className='skill-chip'; chip.textContent=s; vSkills.appendChild(chip); });
    }

    function enterEdit(){
      const profile = readProfile();
      document.getElementById('profileForm').style.display='block';
      document.getElementById('viewDetails').style.display='none';
      document.getElementById('editBtn').style.display='none';
      document.getElementById('saveBtn').style.display='inline-block';
      document.getElementById('cancelBtn').style.display='inline-block';
      // fill inputs
      document.getElementById('inputName').value = profile.name || '';
      document.getElementById('inputRoll').value = profile.roll || '';
      document.getElementById('inputDept').value = profile.dept || '';
      document.getElementById('inputSem').value = profile.sem || '';
      document.getElementById('inputEmail').value = profile.email || '';
      document.getElementById('inputPhone').value = profile.phone || '';
      document.getElementById('inputAbout').value = profile.about || '';
      // skills
      const sc = document.getElementById('skillsContainer'); sc.innerHTML='';
      (profile.skills || []).forEach(addSkillChipToEditor);
    }

    function exitEdit(){
      document.getElementById('profileForm').style.display='none';
      document.getElementById('viewDetails').style.display='block';
      document.getElementById('editBtn').style.display='inline-block';
      document.getElementById('saveBtn').style.display='none';
      document.getElementById('cancelBtn').style.display='none';
    }

    function addSkillChipToEditor(skill){
      const sc = document.getElementById('skillsContainer');
      const chip = document.createElement('div'); chip.className='skill-chip'; chip.textContent = skill;
      const x = document.createElement('button'); x.textContent='x'; x.style.marginLeft='8px'; x.style.border='none'; x.style.background='transparent'; x.style.cursor='pointer';
      x.addEventListener('click', function(){ chip.remove(); });
      chip.appendChild(x);
      sc.appendChild(chip);
    }

    function saveProfile(){
      const profile = readProfile();
      profile.name = document.getElementById('inputName').value.trim();
      profile.roll = document.getElementById('inputRoll').value.trim();
      profile.dept = document.getElementById('inputDept').value.trim();
      profile.sem = document.getElementById('inputSem').value.trim();
      profile.email = document.getElementById('inputEmail').value.trim();
      profile.phone = document.getElementById('inputPhone').value.trim();
      profile.about = document.getElementById('inputAbout').value.trim();
      // skills
      profile.skills = Array.from(document.getElementById('skillsContainer').querySelectorAll('.skill-chip')).map(c => c.childNodes[0].nodeValue || c.textContent.replace('x','').trim());
      saveProfileObj(profile);
      renderView(profile);
      exitEdit();
    }

    // avatar handling
    function readFileAsDataURL(file, cb){ const r = new FileReader(); r.onload = e=>cb(e.target.result); r.readAsDataURL(file); }
    document.getElementById('avatarArea').addEventListener('click', ()=> document.getElementById('avatarInput').click());
    document.getElementById('changeAvatar').addEventListener('click', ()=> document.getElementById('avatarInput').click());
    document.getElementById('avatarInput').addEventListener('change', function(){ if(this.files && this.files[0]){ readFileAsDataURL(this.files[0], function(data){ const p = readProfile(); p.avatar = data; saveProfileObj(p); renderView(p); }); } });
    document.getElementById('removeAvatar').addEventListener('click', function(){ const p = readProfile(); delete p.avatar; saveProfileObj(p); renderView(p); });

    // drag and drop
    const avatarArea = document.getElementById('avatarArea');
    avatarArea.addEventListener('dragover', function(e){ e.preventDefault(); avatarArea.classList.add('dragover'); });
    avatarArea.addEventListener('dragleave', function(){ avatarArea.classList.remove('dragover'); });
    avatarArea.addEventListener('drop', function(e){ e.preventDefault(); avatarArea.classList.remove('dragover'); const f = e.dataTransfer.files[0]; if(f) readFileAsDataURL(f, data=>{ const p = readProfile(); p.avatar = data; saveProfileObj(p); renderView(p); }); });

    // skills input
    document.getElementById('skillInput').addEventListener('keydown', function(e){ if(e.key === 'Enter'){ e.preventDefault(); const v = this.value.trim(); if(!v) return; addSkillChipToEditor(v); this.value=''; } });

    document.getElementById('editBtn').addEventListener('click', enterEdit);
    document.getElementById('cancelBtn').addEventListener('click', function(){ exitEdit(); });
    document.getElementById('saveBtn').addEventListener('click', saveProfile);

    // initial render
    document.addEventListener('DOMContentLoaded', function(){
      const p = readProfile();
      renderView(p);
    });
  </script>
</body>
</html>

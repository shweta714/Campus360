<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Profile - Campus360</title>
  <link rel="stylesheet" href="student-dashboard.css">
  <script>
    (function(){
      try{
        const raw = localStorage.getItem('campus360_prefs');
        if(!raw) return;
        const prefs = JSON.parse(raw);
        if(prefs && prefs.theme === 'dark'){
          try{ document.documentElement.classList.add('dark-theme'); }catch(e){}
          try{ document.body.classList.add('dark-theme'); }catch(e){}
          try{ document.documentElement.setAttribute('data-theme','dark'); }catch(e){}
        }
      }catch(e){}
    })();
  </script>
  <script src="theme.js" defer></script>
  
</head>

<body>
  <!-- App Sidebar (shared) -->
  <aside class="app-sidebar" id="appSidebar" aria-label="Main navigation">
    <nav class="sidebar-nav">
      <ul>
        <li class="sidebar-item" data-target="student-dashboard.html" title="Home">
          <button class="sidebar-btn" data-href="student-dashboard.html">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
              <path d="M3 10.5L12 4l9 6.5" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" />
              <path d="M5 10.5v7a1 1 0 0 0 1 1h3v-5h6v5h3a1 1 0 0 0 1-1v-7" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" />
            </svg>
          </button>
        </li>
        <li class="sidebar-item" data-target="profile.html" title="Profile Overview">
          <button class="sidebar-btn" data-href="profile.html">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
              <path d="M12 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8z" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" />
              <path d="M4 20a8 8 0 0 1 16 0" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" />
            </svg>
          </button>
        </li>
        <li class="sidebar-item" data-target="exam-panel.html" title="Exam Panel">
          <button class="sidebar-btn" data-href="exam-panel.html">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
              <path d="M3 6.5A2.5 2.5 0 0 1 5.5 4H20" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" />
              <path d="M21 4v14a2 2 0 0 1-2 2H6.5A2.5 2.5 0 0 1 4 17.5V4" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" />
              <path d="M8 14h8" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" />
            </svg>
          </button>
        </li>
        <li class="sidebar-item" data-target="courses.html" title="Resources">
          <button class="sidebar-btn" data-href="courses.html">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
              <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M4 6.5A2.5 2.5 0 0 1 6.5 4H20" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </button>
        </li>
        <li class="sidebar-item" data-target="settings.html" title="Settings">
          <button class="sidebar-btn" data-href="settings.html">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
              <path d="M12 15.5a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7z" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" />
              <path d="M19.4 15a1.8 1.8 0 0 0 .3 2l.1.1a1 1 0 0 1-1.4 1.4l-.1-.1a1.8 1.8 0 0 0-2 .3l-.2.2a1 1 0 0 1-1.4 0l-.2-.2a1.8 1.8 0 0 0-2-.3l-.2.1a1 1 0 0 1-1-.2l-.1-.1a1.8 1.8 0 0 0-.3-2l-.1-.1a1 1 0 0 1 0-1.4l.1-.1a1.8 1.8 0 0 0 .3-2l-.1-.2a1 1 0 0 1 1.1-1.4l.2.1a1.8 1.8 0 0 0 2-.3l.2-.2a1 1 0 0 1 1.4 0l.2.2a1.8 1.8 0 0 0 2 .3l.2-.1a1 1 0 0 1 1 .2l.1.1a1.8 1.8 0 0 0 .3 2l.1.1a1 1 0 0 1 0 1.4l-.1.1z" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" />
            </svg>
          </button>
        </li>
      </ul>
    </nav>
  </aside>
  
  <!-- top navbar removed in favor of sidebar navigation -->

  <main class="profile-page">
    <div class="profile-card">
      <div class="profile-left">
        <div id="avatarArea" class="profile-avatar" title="Click to change avatar">
          <img id="avatarImg" src="" alt="avatar">
        </div>
        <input id="avatarInput" class="hidden-input" type="file" accept="image/*">

        <div class="avatar-controls">
          <button id="changeAvatar" class="btn">Change</button>
          <button id="removeAvatar" class="btn">Remove</button>
        </div>

        <div class="profile-actions">
          <button id="editBtn" class="btn primary">Edit Profile</button>
          <button id="saveBtn" class="btn" style="display:none;">Save</button>
          <button id="cancelBtn" class="btn" style="display:none;">Cancel</button>
        </div>
      </div>

      <div class="profile-right">
        <h2 id="displayName">Your Name</h2>
        <p class="muted" id="displayRoll">Roll: -</p>

        <form id="profileForm" style="display:none; margin-top:12px;">
          <div class="form-row">
            <label>Full name
              <input type="text" id="inputName">
            </label>
            <label>Roll
              <input type="text" id="inputRoll">
            </label>
          </div>
          <div class="form-row">
            <label>Department
              <input type="text" id="inputDept">
            </label>
            <label>Semester
              <input type="text" id="inputSem">
            </label>
          </div>
          <div class="form-row">
            <label>Email
              <input type="email" id="inputEmail">
            </label>
            <label>Phone
              <input type="text" id="inputPhone">
            </label>
          </div>
          <div class="form-row">
            <label>GPA
              <input type="text" id="inputGPA" placeholder="e.g. 8.5">
            </label>
          </div>
          <label>About
            <textarea id="inputAbout" rows="3"></textarea>
          </label>
          <label>Skills (type and press Enter)
            <input id="skillInput" type="text" placeholder="e.g. JavaScript">
          </label>
          <div class="skills-container" id="skillsContainer"></div>
        </form>

        <div id="viewDetails" style="margin-top:12px;">
          <div class="view-grid">
            <div>
              <h3 id="vDept">Department</h3>
              <p class="muted" id="vSem">Semester</p>
            </div>
            <div>
              <h3 id="vEmail">Email</h3>
              <p class="muted" id="vPhone">Phone</p>
            </div>
          </div>

          <div style="margin-top:8px;">
            <h3 id="vGPA">GPA</h3>
            <p class="muted" id="vGPAval">N/A</p>
          </div>

          <h4 style="margin-top:12px;">About</h4>
          <p id="vAbout" class="muted">No info yet.</p>

          <h4 style="margin-top:8px;">Skills</h4>
          <div class="skills-container" id="vSkills"></div>
        </div>

      </div>
    </div>
  </main>

  <script>
    const PROFILE_KEY = 'campus360_profile';
    function readProfile() {
      try { return JSON.parse(localStorage.getItem(PROFILE_KEY) || '{}'); } catch (e) { return {}; }
    }
    function saveProfileObj(obj) { localStorage.setItem(PROFILE_KEY, JSON.stringify(obj)); }

    function renderView(profile) {
      document.getElementById('displayName').textContent = profile.name || 'Your Name';
      document.getElementById('displayRoll').textContent = profile.roll ? ('Roll: ' + profile.roll) : 'Roll: -';
      document.getElementById('vDept').textContent = profile.dept || 'Department';
      document.getElementById('vSem').textContent = profile.sem || 'Semester';
      document.getElementById('vEmail').textContent = profile.email || 'Email';
      document.getElementById('vPhone').textContent = profile.phone || 'Phone';
      document.getElementById('vAbout').textContent = profile.about || 'No info yet.';
    // GPA
    var gpaVal = (profile.gpa !== undefined && profile.gpa !== null && profile.gpa !== '') ? profile.gpa : 'N/A';
    var gpaEl = document.getElementById('vGPAval'); if (gpaEl) gpaEl.textContent = gpaVal;
      // avatar
      const img = document.getElementById('avatarImg');
      if (profile.avatar) { img.src = profile.avatar; } else { img.src = 'https://via.placeholder.com/160x160.png?text=Avatar'; }
      // skills
      const vSkills = document.getElementById('vSkills'); vSkills.innerHTML = '';
      (profile.skills || []).forEach(s => { const chip = document.createElement('div'); chip.className = 'skill-chip'; chip.textContent = s; vSkills.appendChild(chip); });
    }

    function enterEdit() {
      const profile = readProfile();
      document.getElementById('profileForm').style.display = 'block';
      document.getElementById('viewDetails').style.display = 'none';
      document.getElementById('editBtn').style.display = 'none';
      document.getElementById('saveBtn').style.display = 'inline-block';
      document.getElementById('cancelBtn').style.display = 'inline-block';
      // fill inputs
      document.getElementById('inputName').value = profile.name || '';
      document.getElementById('inputRoll').value = profile.roll || '';
      document.getElementById('inputDept').value = profile.dept || '';
      document.getElementById('inputSem').value = profile.sem || '';
      document.getElementById('inputEmail').value = profile.email || '';
      document.getElementById('inputPhone').value = profile.phone || '';
    document.getElementById('inputGPA').value = profile.gpa || '';
      document.getElementById('inputAbout').value = profile.about || '';
      // skills
      const sc = document.getElementById('skillsContainer'); sc.innerHTML = '';
      (profile.skills || []).forEach(addSkillChipToEditor);
    }

    function exitEdit() {
      document.getElementById('profileForm').style.display = 'none';
      document.getElementById('viewDetails').style.display = 'block';
      document.getElementById('editBtn').style.display = 'inline-block';
      document.getElementById('saveBtn').style.display = 'none';
      document.getElementById('cancelBtn').style.display = 'none';
    }

    function addSkillChipToEditor(skill) {
      const sc = document.getElementById('skillsContainer');
      const chip = document.createElement('div'); chip.className = 'skill-chip'; chip.textContent = skill;
      const x = document.createElement('button'); x.textContent = 'x'; x.style.marginLeft = '8px'; x.style.border = 'none'; x.style.background = 'transparent'; x.style.cursor = 'pointer';
      x.addEventListener('click', function () { chip.remove(); });
      chip.appendChild(x);
      sc.appendChild(chip);
    }

    function saveProfile() {
      const profile = readProfile();
      profile.name = document.getElementById('inputName').value.trim();
      profile.roll = document.getElementById('inputRoll').value.trim();
      profile.dept = document.getElementById('inputDept').value.trim();
      profile.sem = document.getElementById('inputSem').value.trim();
      profile.email = document.getElementById('inputEmail').value.trim();
      profile.phone = document.getElementById('inputPhone').value.trim();
    profile.gpa = (document.getElementById('inputGPA') ? document.getElementById('inputGPA').value.trim() : '');
      profile.about = document.getElementById('inputAbout').value.trim();
      // skills
      profile.skills = Array.from(document.getElementById('skillsContainer').querySelectorAll('.skill-chip')).map(c => c.childNodes[0].nodeValue || c.textContent.replace('x', '').trim());
      saveProfileObj(profile);
      renderView(profile);
      exitEdit();
    }

    // avatar handling
    function readFileAsDataURL(file, cb) { const r = new FileReader(); r.onload = e => cb(e.target.result); r.readAsDataURL(file); }
    document.getElementById('avatarArea').addEventListener('click', () => document.getElementById('avatarInput').click());
    document.getElementById('changeAvatar').addEventListener('click', () => document.getElementById('avatarInput').click());
    document.getElementById('avatarInput').addEventListener('change', function () { if (this.files && this.files[0]) { readFileAsDataURL(this.files[0], function (data) { const p = readProfile(); p.avatar = data; saveProfileObj(p); renderView(p); }); } });
    document.getElementById('removeAvatar').addEventListener('click', function () { const p = readProfile(); delete p.avatar; saveProfileObj(p); renderView(p); });

    // drag and drop
    const avatarArea = document.getElementById('avatarArea');
    avatarArea.addEventListener('dragover', function (e) { e.preventDefault(); avatarArea.classList.add('dragover'); });
    avatarArea.addEventListener('dragleave', function () { avatarArea.classList.remove('dragover'); });
    avatarArea.addEventListener('drop', function (e) { e.preventDefault(); avatarArea.classList.remove('dragover'); const f = e.dataTransfer.files[0]; if (f) readFileAsDataURL(f, data => { const p = readProfile(); p.avatar = data; saveProfileObj(p); renderView(p); }); });

    // skills input
    document.getElementById('skillInput').addEventListener('keydown', function (e) { if (e.key === 'Enter') { e.preventDefault(); const v = this.value.trim(); if (!v) return; addSkillChipToEditor(v); this.value = ''; } });

    document.getElementById('editBtn').addEventListener('click', enterEdit);
    document.getElementById('cancelBtn').addEventListener('click', function () { exitEdit(); });
    document.getElementById('saveBtn').addEventListener('click', saveProfile);

    // initial render
    document.addEventListener('DOMContentLoaded', function () {
      const p = readProfile();
      renderView(p);
    });
  </script>
  <script>
    // Dark theme support removed: preferences are retained but no class toggling is performed.
    (function () {
      const PREF_KEY = 'campus360_prefs';
      document.addEventListener('DOMContentLoaded', function () {
        try {
          // Read prefs silently for compatibility; do not modify document classes.
          const raw = localStorage.getItem(PREF_KEY);
          if (raw) {
            const prefs = JSON.parse(raw);
            // previously applied theme: intentionally a no-op now
          }
        } catch (e) { }
      });
    })();
  </script>
  <script>
    (function initSidebarPage(){
      const sidebar = document.getElementById('appSidebar'); if(!sidebar) return;
      const items = sidebar.querySelectorAll('.sidebar-item');
      const current = window.location.pathname.split('/').pop() || 'profile.html';
      items.forEach(li => {
        const target = li.getAttribute('data-target');
        if (target === current) li.classList.add('active');
        const btn = li.querySelector('.sidebar-btn');
        if (btn) {
          btn.addEventListener('click', function () { items.forEach(x => x.classList.remove('active')); li.classList.add('active'); const href = btn.getAttribute('data-href'); if (href) window.location.href = href; });
          btn.addEventListener('keydown', function (e) { if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); btn.click(); } });
        }
      });
    })();
  </script>
</body>

</html>
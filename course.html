<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Course - Campus360</title>
  <link rel="stylesheet" href="student-dashboard.css">
  <style>
    .course-header{display:flex;justify-content:space-between;align-items:center;gap:12px}
    .course-controls{display:flex;gap:12px;align-items:center}
    .resource-list{list-style:none;padding:0;margin:8px 0 0;display:flex;flex-direction:column;gap:8px}
    .resource-item{display:flex;justify-content:space-between;align-items:center;padding:10px;border-radius:10px;background:linear-gradient(180deg,#fff,#fbfbff);}
  </style>
</head>
<body>
  <nav class="navbar-top">
    <div class="navbar-container">
      <div class="navbar-logo">
        <img src="logo.png" alt="Campus360 Logo" style="height:28px;vertical-align:middle;">
        <span class="navbar-title" id="courseTitle">COURSE</span>
      </div>
      <ul class="navbar-menu">
        <li onclick="window.location.href='courses.html'">&larr; Courses</li>
        <li onclick="window.location.href='student-dashboard.html'">Dashboard</li>
      </ul>
    </div>
  </nav>

  <main class="profile-page">
    <div class="course-hero-card profile-card" style="padding:20px;">
      <div class="course-hero-left">
        <h1 id="titleH">Course</h1>
        <p class="muted" id="courseSubtitle">Course subtitle / instructor</p>
        <p class="muted" id="courseInstructor" style="margin-top:6px;">Instructor: -</p>
  <p class="muted" id="courseDuration">Duration: -</p>
  <p class="muted" id="courseLectures">Lectures: -</p>
  <p class="muted" id="courseCredits">Credits: -</p>

        <div style="margin-top:18px;display:flex;align-items:center;gap:14px;">
          <div class="cc-percent" id="bigPercent" style="--p:0;width:96px;height:96px;display:grid;place-items:center;font-size:18px;border-radius:999px;color:#fff;"></div>
          <div>
            <p class="muted" style="margin:0;" id="progressText">0% complete</p>
            <div class="cc-progress" style="margin-top:8px;width:240px;max-width:60vw;"><div class="cc-progress-fill" id="progressFill" style="width:0%"></div></div>
          </div>
        </div>

  <!-- Start/Resume button removed per request -->

  <div id="courseAlert" style="margin-top:12px;display:none;padding:10px;border-radius:8px;background:#fff6f6;border:1px solid #ffd6d6;color:#7a1b1b;">
          <strong>Note:</strong> No course selected. <a href="courses.html" style="margin-left:8px;color:#7c3aed;">Open Courses list</a>
        </div>
      </div>

      <div class="course-hero-right">
        <div class="course-tabs">
          <button class="tab active" data-tab="resources">Resources</button>
          <button class="tab" data-tab="quiz">Quiz</button>
          <button class="tab" data-tab="notes">Notes</button>
        </div>

        <div class="tab-contents">
          <div id="tab-resources" class="tab-content">
            <h3>Resources</h3>
            <ul id="resList" class="resource-list"></ul>
          </div>

          <div id="tab-quiz" class="tab-content" style="display:none;">
            <h3>Quiz</h3>
            <p class="muted" id="quizIntro">Choose a level and test your understanding.</p>

            <div class="quiz-levels" style="display:flex;gap:10px;margin-top:12px;flex-wrap:wrap;">
              <div class="quiz-card level-card active" data-level="basic" role="button" tabindex="0" onclick="selectLevel('basic')" style="flex:1 1 120px;padding:12px;border-radius:10px;background:linear-gradient(180deg,#f8fbff,#eef6ff);cursor:pointer;box-shadow:0 4px 14px rgba(30,40,80,0.06);">
                <strong>Basic MCQ <span class="best-badge" data-level="basic"></span></strong>
                <div class="muted" style="font-size:0.9rem;margin-top:6px;">Short warm-up questions</div>
              </div>
              <div class="quiz-card level-card" data-level="medium" role="button" tabindex="0" onclick="selectLevel('medium')" style="flex:1 1 120px;padding:12px;border-radius:10px;background:linear-gradient(180deg,#fff8f0,#fff3e8);cursor:pointer;box-shadow:0 4px 14px rgba(30,40,80,0.06);">
                <strong>Medium MCQ <span class="best-badge" data-level="medium"></span></strong>
                <div class="muted" style="font-size:0.9rem;margin-top:6px;">Moderate difficulty</div>
              </div>
              <div class="quiz-card level-card" data-level="hard" role="button" tabindex="0" onclick="selectLevel('hard')" style="flex:1 1 120px;padding:12px;border-radius:10px;background:linear-gradient(180deg,#fff6fb,#f9eefb);cursor:pointer;box-shadow:0 4px 14px rgba(30,40,80,0.06);">
                <strong>Hard MCQ <span class="best-badge" data-level="hard"></span></strong>
                <div class="muted" style="font-size:0.9rem;margin-top:6px;">Challenging questions</div>
              </div>
            </div>

            <div id="quizArea" style="margin-top:14px;">
              <div id="quizPrompt" class="muted" style="margin-bottom:8px;">Select a level to begin the quiz.</div>
              <div id="quizContainer" class="quiz-container"></div>
              <div id="quizControls" style="margin-top:12px; display:flex;gap:8px;align-items:center;">
                <div id="quizResult" style="margin-left:12px; font-weight:600;"></div>
              </div>
            </div>
          </div>

          <div id="tab-notes" class="tab-content" style="display:none;">
            <h3>Notes</h3>
            <p class="muted">Save personal notes for this course. Notes are stored locally in your browser.</p>
            <textarea id="notesText" rows="6" style="width:100%;margin-top:8px;padding:10px;border-radius:8px;border:1px solid #e6e8f0;"></textarea>
            <div style="margin-top:8px;display:flex;gap:8px;align-items:center;">
              <button id="saveNotes" class="btn primary">Save Notes</button>
              <div id="notesSaved" class="muted" style="font-size:0.95rem;"></div>
            </div>
                    <!-- Pre-attached notes / attachments for this course -->
                    <div id="notesAttachments" style="margin-top:14px;">
                      <h4 style="margin:6px 0 8px;">Attachments</h4>
                      <ul id="notesList" class="resource-list"></ul>
                    </div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <script>
    function getQuery(name){
      const params = new URLSearchParams(location.search);
      return params.get(name);
    }
    const courseName = getQuery('name') || 'Unknown Course';
    document.getElementById('courseTitle').textContent = courseName;
    document.getElementById('titleH').textContent = courseName;

    const PROG_KEY = 'course_progress_'+courseName;
    const ENROLL_KEY = 'course_enroll_'+courseName;

    function setBigPercent(p){
      const el = document.getElementById('bigPercent');
      el.style.setProperty('--p', p);
      el.textContent = p + '%';
    }

    function loadCourse(){
      if(courseName === 'Unknown Course'){
        document.getElementById('courseAlert').style.display='block';
        document.getElementById('resList').innerHTML='';
        // quizSection was removed; hide the quiz tab content safely
        const quizTabEl = document.getElementById('tab-quiz'); if(quizTabEl) quizTabEl.style.display = 'none';
        return;
      } else {
        document.getElementById('courseAlert').style.display='none';
      }

  const progress = parseInt(localStorage.getItem(PROG_KEY) || '0',10);
  document.getElementById('progressFill').style.width = progress + '%';
  document.getElementById('progressText').textContent = progress + '% complete';
      setBigPercent(progress);


      const METAS = {
        'DBMS': {
          instructor: 'Dr. Sharma',
          duration: '12 weeks',
          lectures: 42,
          credits: 3,
          resources: [
            { title: 'Syllabus (PDF)', type: 'pdf', href: 'resources/dbms/syllabus.pdf' },
            { title: 'Exam Rubrics (PDF)', type: 'pdf', href: 'resources/dbms/exam-rubrics.pdf' },
            { title: 'Paper Pattern (PDF)', type: 'pdf', href: 'resources/dbms/paper-pattern.pdf' }
          ],
          notes: [
            { title: 'Lecture Slides (PPTX)', type: 'pptx', href: 'resources/dbms/lecture-slides.pptx' },
            { title: 'Quick Notes (PDF)', type: 'pdf', href: 'resources/dbms/quick-notes.pdf' }
          ]
        },
        'DSA (C++)': { instructor:'Prof. Rao', duration:'10 weeks', lectures:36, credits:3 }
      };
      const meta = METAS[courseName] || { instructor:'TBA', duration:'TBD' };
      document.getElementById('courseInstructor').textContent = 'Instructor: ' + meta.instructor;
  document.getElementById('courseDuration').textContent = 'Duration: ' + meta.duration;
  document.getElementById('courseLectures').textContent = 'Lectures: ' + (meta.lectures || 'TBD');
  document.getElementById('courseCredits').textContent = 'Credits: ' + (meta.credits || 'TBD');

      // load notes
      const NOTES_KEY = 'course_notes_'+courseName;
      try{ const n = localStorage.getItem(NOTES_KEY) || ''; document.getElementById('notesText').value = n; }catch(e){}

      // resources: prefer metadata resources when provided
      const list = document.getElementById('resList'); list.innerHTML='';
      const resources = meta.resources || [
        {title:'Lecture 1 - Introduction', type:'video'},
        {title:'Assignment 1', type:'pdf'},
        {title:'Lab 1 - Setup', type:'link'}
      ];
      resources.forEach((r,i)=>{
        const li = document.createElement('li');
        li.className='resource-item';
        const left = document.createElement('div');
        left.innerHTML = `<strong>${r.title}</strong><div class="muted">${r.type || ''}</div>`;
        const right = document.createElement('div');
        if(r.href){
          // show an Open link for downloadable/visible resources
          const a = document.createElement('a'); a.href = r.href; a.target = '_blank'; a.className = 'btn'; a.textContent = 'Open';
          right.appendChild(a);
        } else {
          const btn = document.createElement('button'); btn.className='btn'; btn.textContent='Open'; btn.setAttribute('data-idx', i);
          right.appendChild(btn);
        }
        li.appendChild(left); li.appendChild(right);
        list.appendChild(li);
      });

      // wire mark/open behavior for any generated buttons without href
      list.querySelectorAll('button[data-idx]').forEach(btn=>{
        btn.addEventListener('click', function(){
          // increment progress and persist as a lightweight action
          let p = parseInt(localStorage.getItem(PROG_KEY) || '0',10);
          p = Math.min(100, p + 10);
          localStorage.setItem(PROG_KEY, p);
          loadCourse();
        });
      });

      // render notes attachments (pre-attached PDFs/PPTs)
      const notesList = document.getElementById('notesList'); if(notesList){ notesList.innerHTML = ''; const notes = meta.notes || []; if(notes.length===0){ notesList.innerHTML = '<li class="muted">No attachments</li>'; } else {
        notes.forEach((n,i)=>{
          const li = document.createElement('li'); li.className='resource-item';
          const left = document.createElement('div'); left.innerHTML = `<strong>${n.title}</strong><div class='muted' style='font-size:0.9rem'>${n.type || ''}</div>`;
          const right = document.createElement('div');
          if(n.href){
            const a = document.createElement('a'); a.href = n.href; a.target = '_blank'; a.className='btn'; a.textContent = 'Open';
            // if pdf, show preview button
            right.appendChild(a);
            if(n.type === 'pdf'){
              const pv = document.createElement('button'); pv.className='btn'; pv.style.marginLeft='8px'; pv.textContent='Preview'; pv.addEventListener('click', function(){ openPreview(n.href); });
              right.appendChild(pv);
            }
          } else {
            const btn = document.createElement('button'); btn.className='btn'; btn.textContent='Open'; right.appendChild(btn);
          }
          li.appendChild(left); li.appendChild(right); notesList.appendChild(li);
        });
      }}
    }

    document.addEventListener('DOMContentLoaded', function(){
      loadCourse();
  // enroll toggle and manual +10 button removed per request
      // notes save
      document.getElementById('saveNotes').addEventListener('click', function(){
        const val = document.getElementById('notesText').value || '';
        try{ localStorage.setItem('course_notes_'+courseName, val); document.getElementById('notesSaved').textContent = 'Saved'; setTimeout(()=>document.getElementById('notesSaved').textContent='',1500); }catch(e){}
      });

      // hero entrance animation
      const hero = document.querySelector('.course-hero-card');
      if(hero){ hero.style.opacity = 0; hero.style.transform = 'translateY(6px)'; setTimeout(()=>{ hero.style.transition='opacity .36s ease, transform .36s ease'; hero.style.opacity = 1; hero.style.transform='translateY(0)'; }, 80); }
  // honor tab= query param if present
  const initialTab = getQuery('tab'); if(initialTab){ setTimeout(()=>{ showTab(initialTab); }, 120); }
    });

    // DBMS question sets supplied by user
    const LEVEL_QUIZ_DB = {
      basic: [
        { q:'DBMS stands for:', opts:['Database Managing Software','Database Management System','Data Backup Management System','Database Managing Server'], a:1 },
        { q:'A table row is also called a:', opts:['Column','Record','Attribute','Key'], a:1 },
        { q:'Which SQL keyword is used to fetch data?', opts:['GET','SHOW','SELECT','FETCH'], a:2 },
        { q:'What uniquely identifies a record in a table?', opts:['Foreign Key','Candidate Key','Primary Key','Alternate Key'], a:2 },
        { q:'Which of these is NOT a DBMS software?', opts:['MySQL','Oracle','MS Word','PostgreSQL'], a:2 },
        { q:'A table column is also called a:', opts:['Tuple','Attribute','Relation','Field'], a:1 },
        { q:'SQL stands for:', opts:['Structured Query Language','Simple Query Language','Sequential Query Language','Structured Question Language'], a:0 },
        { q:'Which type of database model uses tables?', opts:['Hierarchical','Relational','Network','Object-Oriented'], a:1 },
        { q:'Which constraint ensures a value is not null?', opts:['UNIQUE','PRIMARY KEY','NOT NULL','CHECK'], a:2 },
        { q:'Which of these is a DBMS function?', opts:['Data Storage','Data Retrieval','Backup & Recovery','All of the above'], a:3 }
      ],
      medium: [
        { q:'What is a foreign key?', opts:['A key used to link two tables','A unique key in a table','A key with null values','A primary key in another schema'], a:0 },
        { q:'Which normal form removes transitive dependency?', opts:['1NF','2NF','3NF','BCNF'], a:2 },
        { q:'Which SQL command deletes a table?', opts:['DELETE','REMOVE','DROP','CLEAR'], a:2 },
        { q:'Which of these is a DML command?', opts:['CREATE','DROP','SELECT','ALTER'], a:2 },
        { q:'Which join displays unmatched rows too?', opts:['INNER JOIN','FULL OUTER JOIN','LEFT JOIN','CROSS JOIN'], a:1 },
        { q:'Candidate key means:', opts:['A key that uniquely identifies rows','A foreign key','A duplicate key','A primary key'], a:0 },
        { q:'Which SQL constraint ensures unique column values?', opts:['UNIQUE','PRIMARY KEY','NOT NULL','CHECK'], a:0 },
        { q:'Composite key is:', opts:['A key with multiple attributes','A primary key','A foreign key','A duplicate key'], a:0 },
        { q:'TCL commands include:', opts:['COMMIT','SAVEPOINT','ROLLBACK','All of the above'], a:3 },
        { q:'Which database model uses parent-child structure?', opts:['Relational','Network','Hierarchical','Object-Oriented'], a:2 }
      ],
      hard: [
        { q:'A trigger is:', opts:['A constraint','An automatic action on events','A backup','An index'], a:1 },
        { q:'Highest isolation level in DBMS:', opts:['READ COMMITTED','REPEATABLE READ','SERIALIZABLE','READ UNCOMMITTED'], a:2 },
        { q:'Difference between DELETE and TRUNCATE:', opts:['DELETE removes all rows','TRUNCATE removes selected rows','DELETE removes selected rows, TRUNCATE removes all','Both are same'], a:2 },
        { q:'Which ensures no duplicate rows?', opts:['UNIQUE','CHECK','NOT NULL','FOREIGN KEY'], a:0 },
        { q:'What is BCNF?', opts:['Boyce-Codd Normal Form','Binary Coded Normal Form','Base Column Normal Form','None'], a:0 },
        { q:'Clustered index means:', opts:['Index separate from table','Index defines physical order','Index with nulls','Multiple keys index'], a:1 },
        { q:'What is a transaction?', opts:['A single SQL command','A set of operations executed together','A backup process','A rollback'], a:1 },
        { q:'Deadlock happens when:', opts:['Multiple processes wait for each other’s resources','Table has no primary key','Database crashes','Keys are missing'], a:0 },
        { q:'Functional dependency means:', opts:['Attribute depends on another','Column depends on table','Row depends on another row','Table depends on schema'], a:0 },
        { q:'Which command undoes changes?', opts:['SAVEPOINT','COMMIT','ROLLBACK','DELETE'], a:2 }
      ]
    };

    let currentLevel = 'basic';

    // ensure QUIZ_DB exists for course-level fallback (empty by default)
    const QUIZ_DB = window.QUIZ_DB || {};

    function renderLevelQuiz(){
      const qlist = LEVEL_QUIZ_DB[currentLevel] || [];
      const container = document.getElementById('quizContainer'); if(!container) return;
      container.innerHTML='';
      if(!qlist.length){ container.innerHTML = '<p class="muted">No questions for this level.</p>'; return; }
      qlist.forEach((item, idx)=>{
        const qdiv = document.createElement('div'); qdiv.className='quiz-question';
        const qh = document.createElement('h4'); qh.textContent = (idx+1)+'. '+item.q; qdiv.appendChild(qh);
        const opts = document.createElement('div'); opts.className='quiz-opts';
        item.opts.forEach((opt,i)=>{
          const id = `l${currentLevel}q${idx}o${i}`;
          const r = document.createElement('label'); r.style.display='block'; r.style.marginTop='6px';
          r.innerHTML = `<input type='radio' name='lq${idx}' value='${i}' id='${id}' style='margin-right:8px;'> ${opt}`;
          opts.appendChild(r);
        });
        qdiv.appendChild(opts);
        container.appendChild(qdiv);
      });
      // add evaluate control
      const controls = document.createElement('div'); controls.className='quiz-controls';
      controls.innerHTML = `<button id="evalBtn" class="btn primary">Evaluate</button><div id="quizResult" style="font-weight:700;margin-left:8px"></div>`;
      container.appendChild(controls);
      document.getElementById('evalBtn').addEventListener('click', function(){
        let score = 0;
        qlist.forEach((item, idx)=>{ const sel = document.querySelector(`input[name='lq${idx}']:checked`); const val = sel ? parseInt(sel.value,10) : -1; if(val === item.a) score++; });
        const pct = Math.round((score/qlist.length)*100);
        const res = document.getElementById('quizResult'); if(res) res.textContent = `${score}/${qlist.length} (${pct}%)`;
        // store best
        try{ const key = 'course_level_best_'+currentLevel+'_'+courseName; const prev = parseInt(localStorage.getItem(key)||'0',10); if(pct>prev) localStorage.setItem(key, pct); }catch(e){}
      });
    }

    // call renderQuiz after loadCourse
  document.addEventListener('DOMContentLoaded', function(){ renderQuiz();
      // level-card click wiring (kept for resilience) - keyboard support handled by selectLevel
      document.querySelectorAll('.level-card').forEach(card=>{
        card.addEventListener('click', function(){ document.querySelectorAll('.level-card').forEach(c=>c.classList.remove('active')); this.classList.add('active'); currentLevel = this.dataset.level || 'basic'; const prompt = document.getElementById('quizPrompt'); if(prompt) prompt.style.display='none'; renderLevelQuiz(); });
        card.addEventListener('keydown', function(e){ if(e.key === 'Enter' || e.key === ' ') { e.preventDefault(); selectLevel(this.dataset.level || 'basic'); } });
      });
    });

    // show best-score badges for each level if available in localStorage
    function updateBestBadges(){
      document.querySelectorAll('.best-badge').forEach(el=>{
        const level = el.dataset.level || '';
        try{
          const key = 'course_level_best_' + level + '_' + courseName;
          const val = parseInt(localStorage.getItem(key) || '0',10);
          if(val > 0){ el.textContent = 'Best ' + val + '%'; el.style.background = '#7c3aed'; el.style.color='#fff'; el.style.padding='2px 8px'; el.style.borderRadius='999px'; el.style.fontSize='12px'; }
          else { el.textContent = ''; }
        }catch(e){ el.textContent=''; }
      });
    }

    // call after initial load
    document.addEventListener('DOMContentLoaded', updateBestBadges);

    // global helper used by inline onclick handlers - navigate to per-level quiz page
    function selectLevel(lvl){
      try{
        const url = 'quiz-level.html?name=' + encodeURIComponent(courseName) + '&level=' + encodeURIComponent(lvl || 'basic');
        window.location.href = url;
      }catch(e){ console.error('selectLevel error', e); }
    }

    // Tab handlers
    function showTab(name){
      document.querySelectorAll('.course-tabs .tab').forEach(t=> t.classList.toggle('active', t.dataset.tab===name));
      document.querySelectorAll('.tab-content').forEach(c=> c.style.display = (c.id === 'tab-'+name) ? '' : 'none');
      if(name === 'quiz'){
        // clear any previously rendered questions and show prompt until user selects a level
  const container = document.getElementById('quizContainer'); if(container) container.innerHTML='';
  const res = document.getElementById('quizResult'); if(res) res.textContent='';
        const prompt = document.getElementById('quizPrompt'); if(prompt) prompt.style.display='block';
      }
      if(name === 'resources') loadCourse();
    }

    // Preview modal for PDFs
    function openPreview(href){
      // create simple modal with iframe
      let modal = document.getElementById('pdfPreviewModal');
      if(!modal){
        modal = document.createElement('div'); modal.id='pdfPreviewModal'; modal.style.position='fixed'; modal.style.inset='0'; modal.style.background='rgba(0,0,0,0.6)'; modal.style.display='flex'; modal.style.alignItems='center'; modal.style.justifyContent='center'; modal.style.zIndex='9999';
        const box = document.createElement('div'); box.style.width='80%'; box.style.height='80%'; box.style.background='#fff'; box.style.borderRadius='10px'; box.style.overflow='hidden'; box.style.position='relative';
        const close = document.createElement('button'); close.textContent='Close'; close.className='btn'; close.style.position='absolute'; close.style.top='10px'; close.style.right='10px'; close.addEventListener('click', ()=>{ modal.remove(); });
        const iframe = document.createElement('iframe'); iframe.style.width='100%'; iframe.style.height='100%'; iframe.style.border='0'; iframe.id='pdfPreviewFrame';
        box.appendChild(close); box.appendChild(iframe); modal.appendChild(box); document.body.appendChild(modal);
      }
      const frame = document.getElementById('pdfPreviewFrame'); if(frame) frame.src = href;
    }

    document.addEventListener('click', function(e){
      const tab = e.target.closest('.course-tabs .tab');
      if(tab){ showTab(tab.dataset.tab); }
    });
  </script>
</body>
</html>